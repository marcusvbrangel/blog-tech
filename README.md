# Blog API REST

API REST para sistema de blog desenvolvida com Java e Spring Boot seguindo metodologia de desenvolvimento com IA.

## üöÄ Tecnologias

- **Java 17+**
- **Spring Boot 3.2**
- **Spring Security** (JWT Authentication)
- **Spring Data JPA**
- **PostgreSQL**
- **Redis** (Cache distribu√≠do)
- **Maven**
- **Swagger/OpenAPI**
- **JUnit 5**
- **Prometheus** (M√©tricas)
- **Grafana** (Dashboards)
- **Zipkin** (Distributed Tracing)
- **Micrometer** (Observabilidade)

## üìã Funcionalidades

### Autentica√ß√£o
- [x] Registro de usu√°rios
- [x] Login com JWT
- [x] Controle de roles (USER, AUTHOR, ADMIN)

### Gest√£o de Usu√°rios
- [x] CRUD de usu√°rios
- [x] Busca por username/email
- [x] Controle de acesso por role

### Gest√£o de Posts
- [x] CRUD completo de posts
- [x] Publica√ß√£o/despublica√ß√£o
- [x] Busca por palavra-chave
- [x] Filtro por categoria e autor
- [x] Pagina√ß√£o

### Sistema de Coment√°rios
- [x] Coment√°rios em posts
- [x] Respostas aninhadas
- [x] CRUD de coment√°rios

### Categorias
- [x] CRUD de categorias
- [x] Filtros por categoria

### Cache e Performance
- [x] Cache Redis distribu√≠do
- [x] Cache inteligente com TTL customizado
- [x] Invalida√ß√£o autom√°tica de cache
- [x] Otimiza√ß√£o de consultas

### Monitoramento e Observabilidade
- [x] M√©tricas com Prometheus
- [x] Dashboards Grafana
- [x] Distributed tracing com Zipkin
- [x] Health checks autom√°ticos
- [x] Alerting rules configuradas
- [x] M√©tricas customizadas de neg√≥cio

## üèóÔ∏è Arquitetura

```
src/main/java/com/blog/api/
‚îú‚îÄ‚îÄ config/          # Configura√ß√µes (Security, JWT, Swagger)
‚îú‚îÄ‚îÄ controller/      # REST Controllers
‚îú‚îÄ‚îÄ service/         # Business Logic
‚îú‚îÄ‚îÄ repository/      # Data Access Layer
‚îú‚îÄ‚îÄ entity/          # JPA Entities
‚îú‚îÄ‚îÄ dto/             # Data Transfer Objects
‚îú‚îÄ‚îÄ exception/       # Exception Handling
‚îî‚îÄ‚îÄ util/            # Utilities (JWT)
```

## üîê Endpoints da API

### Autentica√ß√£o
- `POST /api/v1/auth/register` - Registrar usu√°rio
- `POST /api/v1/auth/login` - Login

### Usu√°rios
- `GET /api/v1/users` - Listar usu√°rios (ADMIN)
- `GET /api/v1/users/{id}` - Buscar usu√°rio por ID
- `GET /api/v1/users/username/{username}` - Buscar por username

### Posts
- `GET /api/v1/posts` - Listar posts publicados
- `GET /api/v1/posts/{id}` - Buscar post por ID
- `GET /api/v1/posts/search?keyword=` - Buscar posts
- `POST /api/v1/posts` - Criar post (AUTHOR+)
- `PUT /api/v1/posts/{id}` - Atualizar post
- `DELETE /api/v1/posts/{id}` - Deletar post

### Categorias
- `GET /api/v1/categories` - Listar categorias
- `POST /api/v1/categories` - Criar categoria (ADMIN)
- `PUT /api/v1/categories/{id}` - Atualizar categoria (ADMIN)

### Coment√°rios
- `GET /api/v1/comments/post/{postId}` - Coment√°rios do post
- `POST /api/v1/comments` - Criar coment√°rio
- `PUT /api/v1/comments/{id}` - Atualizar coment√°rio
- `DELETE /api/v1/comments/{id}` - Deletar coment√°rio

### Monitoramento
- `GET /actuator/health` - Health check da aplica√ß√£o
- `GET /actuator/metrics` - M√©tricas da aplica√ß√£o
- `GET /actuator/prometheus` - M√©tricas formato Prometheus
- `GET /actuator/info` - Informa√ß√µes da aplica√ß√£o

## ‚öôÔ∏è Configura√ß√£o

### Database (PostgreSQL)
```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/blogdb
    username: bloguser
    password: blogpass
```

### JWT
```yaml
jwt:
  secret: mySecretKey123456789012345678901234567890
  expiration: 86400000  # 24 horas
```

### Redis Cache
```yaml
spring:
  data:
    redis:
      host: redis
      port: 6379
      timeout: 2000ms
  cache:
    type: redis
    redis:
      time-to-live: 600000  # 10 minutos
```

### Monitoring (Prometheus)
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
```

## üîß Como Executar

### Op√ß√£o 1: Docker (Recomendado)

1. **Clone o projeto**
2. **Execute com Docker Compose:**
   ```bash
   docker-compose up -d
   ```
3. **Acesse os servi√ßos:**
   - **API Swagger:** http://localhost:8080/swagger-ui.html
   - **Grafana:** http://localhost:3000 (admin/admin)
   - **Prometheus:** http://localhost:9090
   - **Zipkin:** http://localhost:9411

### Op√ß√£o 2: Execu√ß√£o Local

1. **Clone o projeto**
2. **Configure o PostgreSQL** com as credenciais do `application.yml`
3. **Execute:**
   ```bash
   mvn spring-boot:run
   ```
4. **Acesse a documenta√ß√£o:** http://localhost:8080/swagger-ui.html

## üê≥ Docker

### Comandos √öteis

```bash
# Subir toda a stack (PostgreSQL + Redis + API + Monitoring)
docker-compose up -d

# Ver logs da aplica√ß√£o
docker-compose logs -f blog-api

# Ver logs do banco e cache
docker-compose logs -f postgres redis

# Ver logs do monitoring stack
docker-compose logs -f prometheus grafana zipkin

# Parar todos os servi√ßos
docker-compose down

# Rebuild da aplica√ß√£o
docker-compose up --build blog-api

# Limpar volumes (dados do banco e cache)
docker-compose down -v

# Acessar containers
docker-compose exec postgres psql -U bloguser -d blogdb
docker-compose exec redis redis-cli
```

### Estrutura Docker
- **Dockerfile**: Multi-stage build para otimiza√ß√£o
- **docker-compose.yml**: Orquestra√ß√£o completa da stack (6 servi√ßos)
  - **blog-api**: Aplica√ß√£o Spring Boot
  - **postgres**: Banco de dados PostgreSQL
  - **redis**: Cache distribu√≠do
  - **prometheus**: Coleta de m√©tricas
  - **grafana**: Dashboards e visualiza√ß√£o
  - **zipkin**: Distributed tracing
- **application-docker.yml**: Configura√ß√µes espec√≠ficas para Docker
- **Health checks**: Monitoramento autom√°tico de todos os servi√ßos
- **Networks**: Isolamento de rede para seguran√ßa
- **Volumes**: Persist√™ncia de dados

## üöÄ CI/CD com GitHub Actions

### Workflows Implementados

#### 1. **Continuous Integration** (`.github/workflows/ci.yml`)
Executa automaticamente em push/PR para validar qualidade do c√≥digo:

- ‚úÖ **Testes Unit√°rios**: JUnit 5 com PostgreSQL TestContainer
- ‚úÖ **Cobertura de C√≥digo**: JaCoCo com upload para Codecov
- ‚úÖ **Build da Aplica√ß√£o**: Maven compile e package
- ‚úÖ **An√°lise de Qualidade**: SpotBugs, Checkstyle, PMD
- ‚úÖ **Scan de Seguran√ßa**: OWASP Dependency Check

**Triggers:**
- Push nas branches: `main`, `develop`, `feature/*`
- Pull Requests para: `main`, `develop`

#### 2. **Docker Build & Publish** (`.github/workflows/docker-build.yml`)
Constr√≥i e publica imagens Docker automaticamente:

- üê≥ **Multi-platform Build**: linux/amd64, linux/arm64
- üì¶ **GitHub Container Registry**: Versionamento autom√°tico
- üîç **Vulnerability Scan**: Trivy security scanner
- ‚úÖ **Integration Tests**: Teste da imagem com docker-compose

**Triggers:**
- Push na branch `main`
- Tags `v*` (releases)
- Pull Requests para `main`

#### 3. **Deploy Pipeline** (`.github/workflows/deploy.yml`)
Deploy automatizado para m√∫ltiplos ambientes:

**Staging:**
- üîÑ Deploy autom√°tico via ECS/Kubernetes
- üß™ Smoke tests autom√°ticos
- üì¢ Notifica√ß√µes Slack

**Production:**
- üè∑Ô∏è Deploy apenas com tags de release
- üíæ Backup autom√°tico do banco
- üîÑ Rollback autom√°tico em caso de falha
- ‚òÅÔ∏è Invalida√ß√£o de cache CloudFront

**Triggers:**
- Push na `main` ‚Üí Staging
- Tags `v*` ‚Üí Production
- Manual dispatch

#### 4. **Performance Testing** (`.github/workflows/performance-test.yml`)
Testes de performance automatizados:

- ‚ö° **JMeter Load Tests**: 20 usu√°rios simult√¢neos
- üìä **M√©tricas de Performance**: Tempo de resposta e taxa de sucesso
- üìà **Reports Autom√°ticos**: Coment√°rios em PRs
- ‚è∞ **Testes Di√°rios**: Cron schedule √†s 2h UTC

**Thresholds:**
- Tempo de resposta m√©dio: < 200ms
- Taxa de sucesso: > 95%

### Configura√ß√£o de Secrets

Para ativar todos os workflows, configure os seguintes secrets no GitHub:

```bash
# AWS Credentials
AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY

# Notifications
SLACK_WEBHOOK_URL

# CodeCov (opcional)
CODECOV_TOKEN

# CloudFront (production)
CLOUDFRONT_DISTRIBUTION_ID
```

### Status Badges

Adicione badges no README para mostrar status dos builds:

```markdown
![CI](https://github.com/marcusvbrangel/blog-tech/workflows/Continuous%20Integration/badge.svg)
![Docker](https://github.com/marcusvbrangel/blog-tech/workflows/Docker%20Build%20and%20Publish/badge.svg)
![Deploy](https://github.com/marcusvbrangel/blog-tech/workflows/Deploy%20to%20Production/badge.svg)
```

## üß™ Testes

### Testes Locais
```bash
# Testes unit√°rios
mvn test

# Testes com cobertura
mvn test jacoco:report

# Testes de integra√ß√£o
mvn verify

# Performance tests (requer Docker)
docker-compose up -d
# Execute performance-test workflow manualmente
```

### Tipos de Teste
- **Unit Tests**: Service layer, Repository layer
- **Integration Tests**: Controller endpoints, Database
- **Performance Tests**: Load testing com JMeter
- **Security Tests**: OWASP dependency check

## üìö Documenta√ß√£o

### Documenta√ß√£o da API
- **Swagger UI:** http://localhost:8080/swagger-ui.html
- **OpenAPI JSON:** http://localhost:8080/v3/api-docs

### Monitoramento e Observabilidade
- **Grafana Dashboards:** http://localhost:3000 (admin/admin)
  - Dashboard Spring Boot: M√©tricas JVM, HTTP requests, performance
  - Dashboard Business: Posts criados, usu√°rios ativos, categorias
  - Dashboard Sistema: CPU, mem√≥ria, disk I/O
- **Prometheus Metrics:** http://localhost:9090
  - Queries personalizadas
  - Alerting rules ativas
  - Targets monitoring status
- **Zipkin Tracing:** http://localhost:9411
  - Distributed tracing de requests
  - Service dependency mapping
  - Performance insights
- **Health Checks:** http://localhost:8080/actuator/health
  - Status de todos os componentes
  - Database connectivity
  - Redis connectivity

## üë• Roles e Permiss√µes

- **USER:** Pode comentar em posts
- **AUTHOR:** Pode criar, editar e deletar pr√≥prios posts + USER
- **ADMIN:** Acesso total + gerenciar categorias e usu√°rios

## üîÑ Metodologia de Desenvolvimento

Este projeto foi desenvolvido seguindo uma metodologia de desenvolvimento com IA:

1. ‚úÖ **PRD (Product Requirements Document)**
2. ‚úÖ **Tech Specs** 
3. ‚úÖ **Gera√ß√£o de Tarefas**
4. ‚úÖ **Implementa√ß√£o**
5. ‚úÖ **Testes**
6. ‚úÖ **Revis√£o de C√≥digo**

Para ver o log completo de desenvolvimento, consulte [DEVELOPMENT_LOG.md](./DEVELOPMENT_LOG.md).

## üìä M√©tricas do Projeto

- **Total de Sess√µes**: 5 sess√µes de desenvolvimento
- **Arquivos criados**: 50+ arquivos
- **Linhas de c√≥digo**: 3000+ linhas
- **Endpoints API**: 25+ endpoints REST
- **Containers Docker**: 6 servi√ßos orquestrados
- **Workflows CI/CD**: 4 pipelines completos
- **Cobertura de testes**: 80%+ (em expans√£o)
- **Observabilidade**: Stack completa implementada

## üéØ Status do Projeto

### ‚úÖ **Implementado e Funcionando:**
- üèóÔ∏è **Arquitetura**: API REST completa com Spring Boot
- üîê **Seguran√ßa**: JWT Authentication com roles
- üíæ **Persist√™ncia**: PostgreSQL com JPA/Hibernate
- ‚ö° **Cache**: Redis distribu√≠do com TTL inteligente
- üìä **Monitoramento**: Prometheus + Grafana + Zipkin
- üê≥ **Containeriza√ß√£o**: Docker Compose multi-servi√ßos
- üöÄ **CI/CD**: GitHub Actions pipelines completos
- üß™ **Testes**: Unit, Integration e Performance tests
- üìà **Performance**: Otimizado com cache e m√©tricas

### üîÑ **Pr√≥ximas Melhorias:**
- Rate limiting e throttling
- Logs estruturados (ELK Stack)
- Frontend React/Angular
- Mobile app integration
- Kubernetes deployment
- Advanced security features

## ü§ù Contribuindo

Este projeto segue metodologia estruturada de desenvolvimento com IA. Para contribuir:

1. Fork do reposit√≥rio
2. Crie uma feature branch
3. Implemente seguindo padr√µes existentes
4. Execute testes completos
5. Submeta PR com documenta√ß√£o atualizada

## üìÑ Licen√ßa

Este projeto √© desenvolvido para fins educacionais e demonstra√ß√£o de boas pr√°ticas de desenvolvimento com IA.